
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Starter ROS workspace for working with the [s]mall [ve]hicles for [a]utonomy platform ">
      
      
        <meta name="author" content="Smart Mobility Lab">
      
      
      
        <link rel="prev" href="../0_intro/">
      
      
        <link rel="next" href="../2_lidar_sim/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.2, mkdocs-material-9.2.8">
    
    
      
        <title>1. Floor 2 and Pure-Pursuit - SVEA</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.046329b4.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#floor-2-and-pure-pursuit" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="SVEA" class="md-header__button md-logo" aria-label="SVEA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            SVEA
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              1. Floor 2 and Pure-Pursuit
            
          </span>
        </div>
      </div>
    </div>
    
    
    
    
      <div class="md-header__source">
        <a href="https://github.com/KTH-SML/svea" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="SVEA" class="md-nav__button md-logo" aria-label="SVEA" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    SVEA
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/KTH-SML/svea" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" checked>
        
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Tutorial
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../0_intro/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    0. Introduction
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    1. Floor 2 and Pure-Pursuit
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    1. Floor 2 and Pure-Pursuit
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#task-1-addressing-overshoot" class="md-nav__link">
    Task 1: Addressing overshoot
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-2-adding-emergency-stops" class="md-nav__link">
    Task 2: Adding emergency stops
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-solution" class="md-nav__link">
    Testing the solution
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../2_lidar_sim/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2. Lidar Simulation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../3_svea_operation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    3. The SVEA
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../4_docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    4. Docker
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../5_more_docker/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    5. Advanced Docker Workflows
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Development
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Development
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../development/documentation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Documentation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Reference
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/models/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../reference/interfaces/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Interfaces
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#task-1-addressing-overshoot" class="md-nav__link">
    Task 1: Addressing overshoot
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#task-2-adding-emergency-stops" class="md-nav__link">
    Task 2: Adding emergency stops
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#testing-the-solution" class="md-nav__link">
    Testing the solution
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="floor-2-and-pure-pursuit">Floor 2 and Pure-Pursuit<a class="headerlink" href="#floor-2-and-pure-pursuit" title="Permanent link">&para;</a></h1>
<p>In this tutorial, we will start interacting with the code base for the SVEA
platform. In particular, you will inspect the pure-pursuit examples we have
implemented and improve upon them to get you ready for running the examples on
the real vehicles.</p>
<p>In this tutorial, there are some criterion you need to fulfill, such as not running
into walls. However, the quality of your solution is up for you to
judge. Ultimately, this tutorial is designed for you to start getting your hands
dirty with your own automated driving system.</p>
<p>We will use the Floor 2 example, so please make sure they work before proceeding
with this tutorial. Check this by running the following without any errors:</p>
<div class="highlight"><pre><span></span><code>roslaunch<span class="w"> </span>svea_examples<span class="w"> </span>floor2.launch
</code></pre></div>
<p>This launch file uses the python script called <code>pure_pursuit.py</code> which can be
can be found in <code>svea/src/svea_examples/scripts</code>. This python script will be
your starting point for this tutorial.</p>
<p>Before you get started with implementing improvements to the Floor 2 example, you
should first create your own version of the example that you can edit. You can do
this by copying <code>svea/src/svea_examples/launch/floor2.launch</code> into
<code>svea/src/&lt;your project package&gt;/launch/</code> and
<code>svea/src/svea_examples/scripts/pure_pursuit.py</code> into
<code>svea/src/&lt;your project package&gt;/scripts/</code>.</p>
<h2 id="task-1-addressing-overshoot">Task 1: Addressing overshoot<a class="headerlink" href="#task-1-addressing-overshoot" title="Permanent link">&para;</a></h2>
<p>When you run the Floor 2 example as is, you will notice that at some turns
the vehicle has a big overshoot and some times gets very close, or even
intersects, with a wall. Since we will run this example on the real SVEA at
then end of the tutorial, this overshoot is unacceptable, as the real SVEA
might actually drive into a wall. Your first task will be to address this
overshoot and avoid colliding with any walls.</p>
<p>Since this is the first issue you are looking into, instead of starting with
the implementation right away, you should start by reading into how the software
driving this example is set up (pun intended). The best place to start is to
inspect the <code>SVEAPurePursuit</code> class definition that is imported in
<code>pure_pursuit.py</code>; do not forget to also look at what class
variables and methods <code>SVEAPurePursuit</code> inherits from <code>SVEAManager</code>.</p>
<p>Did you see how a controller object is passed in and used by a SVEA manager
object? Now that you have looked a bit into how the pure-pursuit SVEA manager is
set up, you should be ready to start looking at the controller definition
itself. You can find the pure-pursuit controller class definition in:</p>
<p><code>svea_core/src/svea/controllers/pure_pursuit.py</code></p>
<p>By looking at and understanding how the pure pursuit controller works, try to
come up with an approach for reducing the overshoot. To address this problem
you may want to read up on how pure pursuit controllers work.</p>
<h2 id="task-2-adding-emergency-stops">Task 2: Adding emergency stops<a class="headerlink" href="#task-2-adding-emergency-stops" title="Permanent link">&para;</a></h2>
<p>Now that you have addressed the overshooting problem, let&rsquo;s try adding an
emergency stop capability to your implementation. Currently, the pure pursuit
example just continuously tracks a path with no intention to stop. In the
case where we do have an obstacle that we know about, we should have the
ability to stop the SVEA automatically.</p>
<p>The most basic version of emergency stops that you should try in this task
is stopping the SVEA if it comes too close to a list of obstacle points. Imagine
that you already know where the obstacles are and they are represented by a
list of XY coordinates (e.g. <code>[(x1, y1), (x2, y2), ...]</code>). Then, you should
try to update your implementation to stop when the SVEA gets too close to
these points. We will leave the definition of being &ldquo;too close&rdquo; up to you.</p>
<p>We recommend that you try to visualize these obstacle points to make it
easier for you to develop this functionality and to make it easier to show
to others. To make your life easier, there&rsquo;s already a number of visualization
functions in <code>svea/src/svea_core/src/svea/simulators/viz_utils.py</code>.</p>
<p>If this is &ldquo;too easy&rdquo; for you, then consider the following enhancements:</p>
<ol>
<li>Use the RVIZ &ldquo;Publish Point&rdquo; button to create obstacles through the <code>/clicked_point</code> ROS topic</li>
<li>Add the walls to the obstacle points by using the map (see <code>svea/src/svea_core/scripts/plot_map.py</code> to see how to work with the map)</li>
</ol>
<p><strong>Tip</strong>: To find the points you want for your trajectory, you can use the
&ldquo;Publish Point&rdquo; tool in the toolbar of the RVIZ window. If you click on the
&ldquo;Pubilsh Point&rdquo; button to activate the tool, when you hover around the map,
you will see the XY coordinate of where your cursor is hovering in the bottom
of the RVIZ window. If you want to know the heading information of a specific
point, use the &ldquo;2D Nav Goal&rdquo; tool instead. If you open a new terminal and run
<code>rostopic echo /move_base_simple/goal</code>, then when you click using the nav goal
tool, you will see the data you want.</p>
<h2 id="testing-the-solution">Testing the solution<a class="headerlink" href="#testing-the-solution" title="Permanent link">&para;</a></h2>
<p>Finally, you are ready to try out your initial solution on the real vehicles!
Also, make sure you have read the &ldquo;Hardware&rdquo; section in the introductory tutorial,
so you understand how the hardware and software are connected to each other.</p>
<p>Then, try linking an external laptop to a real SVEA vehicle&rsquo;s ROS network, by
following the instructions in the &ldquo;Listening to ROS on another computer&rdquo; section
of the repo&rsquo;s README. Once you have established a connection, place the SVEA
vehicle in the area you want it to start in and <strong>turn off the motor</strong> by
switching off the ESC. You can try launching the launch file on the SVEA vehicle
while running an RVIZ client on your laptop. To run the RVIZ client on your
laptop using the same configuration as the floor2 simulator, from
<code>svea_core/rviz/</code> run:</p>
<div class="highlight"><pre><span></span><code>rviz<span class="w"> </span>-d<span class="w"> </span>SVEA_floor2.rviz
</code></pre></div>
<p>Now, confirm that all the data is publishing to RVIZ as you expect it to. Once,
you have confirmed everything runs as you expect it to, then shutdown the
launch to try out the controller. If you try turning on the motor before
shutting down the launch, then, depending on your speed controller
implementation, the vehicle may dangerously jump due to windup (i.e. the speed
controller sees that the velocity is zero and tries to send a higher velocity
signal to the esc until it maxes the velocity out). After shutting down the
launch, turn the ESC on, make sure the SVEA vehicle is still in the position you
want it in. Make sure you are holding the corresponding RC remote and are ready
to block the signal from your implementation using the metal switch on top of
the remote by switching it to the forward position. Then, with the metal switch
on top of the remote in the middle position, try running your launch once more,
and see what happens!</p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      2020, Smart Mobility Lab
    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.dfff1995.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.dff1b7c8.min.js"></script>
      
        <script src="../../mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>